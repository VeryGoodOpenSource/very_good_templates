name: Kotlin Format

on:
  workflow_call:
    inputs:
      working_directory:
        required: true
        type: string
        description: "The working directory containing Kotlin files to format"
      ktlint_version:
        required: false
        type: string
        default: "1.5.0"
        description: "The version of ktlint to use"

jobs:
  kotlin-format:
    runs-on: ubuntu-latest

    defaults:
      run:
        working-directory: ${{ inputs.working_directory }}

    steps:
      - name: ðŸ“š Git Checkout
        uses: actions/checkout@v6

      - name: â˜• Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: "temurin"
          java-version: "17"

      - name: ðŸ“¥ Install ktlint
        run: |
          curl -sSLO https://github.com/pinterest/ktlint/releases/download/${{ inputs.ktlint_version }}/ktlint
          chmod a+x ktlint
          sudo mv ktlint /usr/local/bin/

      - name: âœ¨ Check Kotlin Formatting
        run: |
          ktlint --editorconfig="${GITHUB_WORKSPACE}/.editorconfig" "**/*.kt" "**/*.kts" || {
            echo "::error::Kotlin formatting issues found. Run 'ktlint --format' locally to fix."
            exit 1
          }
